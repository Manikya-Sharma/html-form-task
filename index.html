<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <title>HTML Forms Submission</title>
  </head>
  <body>
    <header>
      <h1>Personal Info</h1>
      <p>Update your personal details here</p>
    </header>
    <main>
      <form id="main-form">
        <div>
          <label for="name">Name</label>
          <input
            id="name"
            name="name"
            type="text"
            placeholder="Your name"
            required
          />
        </div>

        <div>
          <label for="email">Email</label>
          <input
            name="email"
            type="email"
            id="email"
            placeholder="Your email address"
            required
          />
        </div>

        <div class="double-input">
          <div>
            <label for="age">Age</label>
            <input
              id="age"
              name="age"
              type="number"
              placeholder="Your age"
              required
            />
          </div>

          <div>
            <label for="phone">Telephone</label>
            <input
              name="phone"
              type="tel"
              id="phone"
              placeholder="Your phone no."
              required
            />
          </div>
        </div>

        <div>
          <label for="country">Country</label>
          <select id="country" name="country" required>
            <option value="" disabled selected>Your country</option>
            <option value="India">India</option>
            <option value="USA">USA</option>
            <option value="Japan">Japan</option>
            <option value="China">China</option>
          </select>
        </div>

        <div class="gender">
          <label>Gender</label>
          <input
            id="gender-male"
            name="gender"
            type="radio"
            value="Male"
            required
          />
          <label for="gender-male">Male</label>
          <input id="gender-female" name="gender" type="radio" value="Female" />
          <label for="gender-female">Female</label>
          <input id="gender-other" name="gender" type="radio" value="Other" />
          <label for="gender-other">Other</label>
        </div>

        <div>
          <label for="tech">Technological Stack</label>
          <select id="tech" name="tech" multiple required>
            <option value="HTML">HTML</option>
            <option value="CSS">CSS</option>
            <option value="JS">JS</option>
            <option value="React">React</option>
            <option value="React Native">React Native</option>
          </select>
        </div>

        <div>
          <label for="address">Address</label>
          <textarea
            name="address"
            id="address"
            rows="4"
            cols="50"
            required
          ></textarea>
        </div>

        <div class="buttons">
          <button type="reset">Reset</button>
          <button type="submit">Submit</button>
        </div>
      </form>

      <table>
        <tbody id="output-table">
          <tr>
            <th>Key</th>
            <th>Value</th>
          </tr>
        </tbody>
      </table>
    </main>

    <script>
      function convertArrayToString(inputArray) {
        // Convert a given array of values to comma separated string
        return Array(inputArray)
          .reduce((prev, current) => prev + "," + String(current), "")
          .substring(1);
      }

      function clearEntries() {
        // clear the previous entries of the table
        const rows = document.getElementsByClassName("insertedRow");
        // we need to store in separate array to avoid missing nodes while iterating
        const toRemove = [];
        for (const row of rows) {
          toRemove.push(row);
        }
        for (const row of toRemove) {
          row.remove();
        }
      }

      function addEntries(data) {
        for (key in data) {
          const value = data[key];
          const row = document.createElement("tr");

          const keyCell = document.createElement("td");
          keyCell.textContent = key;
          row.appendChild(keyCell);

          const valueCell = document.createElement("td");
          valueCell.textContent = convertArrayToString(value);
          row.appendChild(valueCell);

          row.className = "insertedRow";
          document.getElementById("output-table").appendChild(row);
        }
      }

      document.getElementById("main-form").addEventListener("submit", (e) => {
        // avoid page refresh
        e.preventDefault();

        clearEntries();

        const formData = new FormData(e.target);
        const keys = formData.keys();
        const submittedData = {};
        for (key of keys) {
          // getAll ensures that all values are taken from multiple selection
          submittedData[key] = formData.getAll(key);
        }

        addEntries(submittedData);
      });
    </script>
  </body>
</html>
